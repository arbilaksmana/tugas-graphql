<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GraphQL Book API Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 40px 20px;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      h1 {
        color: #ffffff;
        text-align: center;
        margin-bottom: 40px;
        font-size: 2.5rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }

      .card {
        background: rgba(255, 255, 255, 0.95);
        padding: 30px;
        border-radius: 16px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
      }

      h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.5rem;
        border-bottom: 3px solid #667eea;
        padding-bottom: 10px;
      }

      button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        color: white;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
      }

      button:active {
        transform: translateY(0);
      }

      button.delete-btn {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        padding: 8px 16px;
        font-size: 0.85rem;
        margin-left: 10px;
      }

      button.delete-btn:hover {
        box-shadow: 0 6px 16px rgba(245, 87, 108, 0.6);
      }

      input {
        padding: 12px 16px;
        border-radius: 8px;
        border: 2px solid #e0e0e0;
        margin-right: 10px;
        margin-bottom: 10px;
        font-size: 0.95rem;
        transition: border-color 0.3s ease;
        min-width: 200px;
      }

      input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      ul {
        list-style: none;
        padding: 0;
      }

      li {
        padding: 16px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        margin: 12px 0;
        border-radius: 10px;
        border-left: 5px solid #667eea;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
      }

      li:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .book-info {
        flex: 1;
        font-size: 0.95rem;
        color: #2d3748;
      }

      .book-id {
        font-weight: bold;
        color: #667eea;
      }

      .book-title {
        font-weight: 600;
        color: #1a202c;
      }

      .book-author {
        color: #4a5568;
      }

      .book-genre {
        color: #718096;
        font-style: italic;
      }

      .message-box {
        padding: 16px;
        margin-top: 15px;
        font-weight: 500;
        border-radius: 8px;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .success {
        background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
        color: #0f5132;
        border-left: 5px solid #0f5132;
      }

      .error {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        color: #842029;
        border-left: 5px solid #842029;
      }

      .info {
        background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
        color: #055160;
        border-left: 5px solid #055160;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      @media (max-width: 768px) {
        h1 {
          font-size: 2rem;
        }

        .card {
          padding: 20px;
        }

        input {
          width: 100%;
          margin-right: 0;
        }

        button {
          width: 100%;
          margin-bottom: 10px;
        }

        li {
          flex-direction: column;
          align-items: flex-start;
        }

        button.delete-btn {
          margin-left: 0;
          margin-top: 10px;
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üìö Book GraphQL Dashboard</h1>

      <!-- Section 1: List All Books -->
      <div class="card">
        <h2>üìñ All Books</h2>
        <button onclick="loadAllBooks()">Load All Books</button>
        <ul id="list-book"></ul>
      </div>

      <!-- Section 2: Add New Book -->
      <div class="card">
        <h2>‚ûï Add New Book</h2>
        <div class="form-group">
          <div class="form-row">
            <input type="text" id="title" placeholder="Book Title" />
            <input type="text" id="author" placeholder="Author Name" />
            <input type="text" id="genre" placeholder="Genre (e.g., Fiction, Sci-Fi)" />
          </div>
          <button onclick="addBook()">Add Book</button>
        </div>
        <div id="add-result"></div>
      </div>

      <!-- Section 3: Search Book by ID -->
      <div class="card">
        <h2>üîç Search Book</h2>
        <input type="text" placeholder="Enter Book ID" id="input-id" />
        <button onclick="findBook()">Search</button>
        <div id="search-result"></div>
      </div>
    </div>

    <script>
      // GraphQL endpoint - dynamically detect if running on Railway or localhost
      const url = window.location.hostname === 'localhost' 
        ? 'http://localhost:4003/graphql'
        : `${window.location.origin}/graphql`;

      // === QUERY: Load all books ===
      function loadAllBooks() {
        const query = `
          {
            books {
              id
              title
              author
              genre
            }
          }
        `;

        fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query }),
        })
          .then((res) => res.json())
          .then((result) => {
            if (result.errors) {
              showMessage('list-book', 'Error loading books: ' + result.errors[0].message, 'error');
              return;
            }

            const books = result.data.books;
            const list = document.getElementById('list-book');
            list.innerHTML = '';

            if (books.length === 0) {
              list.innerHTML = '<li><div class="book-info">No books found. Add some books!</div></li>';
              return;
            }

            books.forEach((b) => {
              const li = document.createElement('li');
              li.innerHTML = `
                <div class="book-info">
                  <span class="book-id">#${b.id.substring(0, 8)}</span> - 
                  <span class="book-title">${b.title}</span> by 
                  <span class="book-author">${b.author}</span>
                  <br><span class="book-genre">Genre: ${b.genre}</span>
                </div>
                <button class="delete-btn" onclick="deleteBook('${b.id}')">Delete</button>
              `;
              list.appendChild(li);
            });
          })
          .catch((err) => {
            console.error(err);
            showMessage('list-book', 'Failed to connect to server', 'error');
          });
      }

      // === QUERY: Find book by ID ===
      function findBook() {
        const id = document.getElementById('input-id').value.trim();
        if (!id) {
          showMessage('search-result', 'Please enter a Book ID', 'error');
          return;
        }

        const query = `
          {
            book(id: "${id}") {
              id
              title
              author
              genre
            }
          }
        `;

        fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query }),
        })
          .then((res) => res.json())
          .then((result) => {
            if (result.errors) {
              showMessage('search-result', 'Error: ' + result.errors[0].message, 'error');
              return;
            }

            const book = result.data.book;
            if (!book) {
              showMessage('search-result', 'Book not found', 'error');
              return;
            }

            const message = `
              <strong>${book.title}</strong> by ${book.author}<br>
              Genre: ${book.genre}<br>
              ID: ${book.id}
            `;
            showMessage('search-result', message, 'info');
          })
          .catch((err) => {
            console.error(err);
            showMessage('search-result', 'Failed to connect to server', 'error');
          });
      }

      // === MUTATION: Add new book ===
      function addBook() {
        const title = document.getElementById('title').value.trim();
        const author = document.getElementById('author').value.trim();
        const genre = document.getElementById('genre').value.trim();

        if (!title || !author || !genre) {
          showMessage('add-result', 'Please fill in all fields (title, author, genre)', 'error');
          return;
        }

        const mutation = `
          mutation {
            addBook(title: "${escapeGraphQL(title)}", author: "${escapeGraphQL(author)}", genre: "${escapeGraphQL(genre)}") {
              id
              title
              author
              genre
            }
          }
        `;

        fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query: mutation }),
        })
          .then((res) => res.json())
          .then((result) => {
            if (result.errors) {
              showMessage('add-result', 'Error: ' + result.errors[0].message, 'error');
              return;
            }

            const added = result.data.addBook;
            const message = `‚úÖ Book added successfully: <strong>${added.title}</strong> by ${added.author}`;
            showMessage('add-result', message, 'success');

            // Clear form
            document.getElementById('title').value = '';
            document.getElementById('author').value = '';
            document.getElementById('genre').value = '';

            // Refresh book list
            loadAllBooks();
          })
          .catch((err) => {
            console.error(err);
            showMessage('add-result', 'Failed to connect to server', 'error');
          });
      }

      // === MUTATION: Delete book ===
      function deleteBook(id) {
        if (!confirm('Are you sure you want to delete this book?')) {
          return;
        }

        const mutation = `
          mutation {
            deleteBook(id: "${id}")
          }
        `;

        fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query: mutation }),
        })
          .then((res) => res.json())
          .then((result) => {
            if (result.errors) {
              alert('Error deleting book: ' + result.errors[0].message);
              return;
            }

            // Refresh book list
            loadAllBooks();
          })
          .catch((err) => {
            console.error(err);
            alert('Failed to delete book');
          });
      }

      // Helper function to show messages
      function showMessage(elementId, message, type) {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="message-box ${type}">${message}</div>`;
      }

      // Helper function to escape special characters for GraphQL
      function escapeGraphQL(str) {
        return str.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/\n/g, '\\n');
      }

      // Load books on page load
      window.addEventListener('load', () => {
        loadAllBooks();
      });
    </script>
  </body>
</html>
